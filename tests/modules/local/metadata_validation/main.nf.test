nextflow_process {

    name "Test Process METADATA_VALIDATION"
    script "modules/local/metadata_validation/main.nf"
    process "METADATA_VALIDATION"

    test("Should run without failures") {

        when {
            params {
                // define parameters here. Example:
                // outdir = "tests/results"
                batch_size = 1
                project_dir = "${projectDir}" // (?: do I need this)
                output_dir = "${outputDir}"
                custom_fields_file = "${projectDir}/assets/example_custom_fields.json"
                validate_custom_fields = true
                date_format_flag = 's'
                remove_demographic_info = true
                validate_custom_fields = true
                fetch_reports_only = false
                resolved_output_dir = "${outputDir}" // (?: I'm not sure about this)
                resolved_submission_config = "${projectDir}/conf/submission_config.yaml"
                biosample_fields_key = "${projectDir}/assets/biosample_fields_key.yaml"
            }
            process {
                """
                // define inputs of the process here
                // input[0] = path("${projectDir}/assets/sample_metadata/mpxv_test_metadata.xlsx")
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out.tsv_files).match()
        }

    }

}
